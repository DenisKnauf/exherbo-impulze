# Copyright 2008 Daniel Mierswa <impulze@impulze.org>
# Distributed under the terms of the GNU General Public License v2

require multilib toolchain-funcs

SUMMARY="A library to access popular image formats."
DESCRIPTION="An Open Source library project for developers who would like to
support popular graphics image formats like PNG, BMP, JPEG, TIFF and others as
needed by today's multimedia applications. It is easy to use, fast and
multithreading safe."
HOMEPAGE="http://${PN}.sourceforge.net/"
DOWNLOADS="mirror://sourceforge/freeimage/${PN}${PV//./}.zip"

LICENCES="|| ( GPL-2 FIPL-1.0 )"
SLOT="0"
PLATFORMS="~amd64"
MYOPTIONS=""

DEPENDENCIES=""

WORK="${WORKBASE}/${PN}"
DEFAULT_SRC_COMPILE_PARAMS+=( -f Makefile.gnu )
DEFAULT_SRC_INSTALL_EXTRA_DOCS+=( Whatsnew.txt )

src_prepare() {
    default

    sed \
        -e "/^CC =/s:gcc:$(tc-getCC):" \
        -e "/^CXX =/s:g++:$(tc-getCXX):" \
        -e "/^AR =/s:ar:$(tc-getAR):" \
        -e "/^INCDIR = /s:/usr/include:${IMAGE}/usr/include:" \
        -e "/^INSTALLDIR = /s:/usr/lib:${IMAGE}/usr/$(get_libdir):" \
        -e '/^COMPILERFLAGS =/s:-O3::' \
        -e "/^CFLAGS =/s:= := ${CFLAGS} :" \
        -e "/^CXXFLAGS =/s:= := ${CXXFLAGS} :" \
        -e "/\$(CC) -s/s: -s : -s ${LDFLAGS} :" \
        -e 's:*ldconfig*::' \
        -i Makefile.gnu \
        || die "sed Makefile.gnu failed"
}

src_install() {
    dodir /usr/include "/usr/$(get_libdir)"

    default

    insinto /usr/share/doc/${PNVR}/Examples
    doins -r Examples/*
}
